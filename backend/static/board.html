<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiteboard</title>
    <link rel="stylesheet" href="/vendor/webawesome/styles/webawesome.css">
    <link rel="stylesheet" href="/css/style.css?v=3">
    <script type="importmap">
    {
        "imports": {
            "yjs": "/js/vendor/yjs.mjs"
        }
    }
    </script>
    <script type="module" src="/vendor/webawesome/webawesome.bundle.js" data-webawesome="/vendor/webawesome"></script>
</head>
<body>
    <!-- Top bar -->
    <div id="top-bar">
        <wa-tooltip content="Back to dashboard" placement="bottom">
            <button class="top-btn" id="btn-back">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
        </wa-tooltip>
        <span id="board-name">Untitled Board</span>
        <span id="zoom-level">100%</span>
        <wa-tooltip content="Undo (Ctrl+Z)" placement="bottom">
            <button class="top-btn" id="btn-undo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 10h10a5 5 0 0 1 0 10H9"/>
                    <path d="M3 10l4-4M3 10l4 4"/>
                </svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Redo (Ctrl+Shift+Z)" placement="bottom">
            <button class="top-btn" id="btn-redo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10H11a5 5 0 0 0 0 10h4"/>
                    <path d="M21 10l-4-4M21 10l-4 4"/>
                </svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Share board" placement="bottom">
            <button class="top-btn" id="btn-share">Share</button>
        </wa-tooltip>
    </div>

    <!-- Presence bar -->
    <div id="presence-bar"></div>

    <!-- Toolbar -->
    <div id="toolbar">
        <!-- Selection & Navigation -->
        <wa-tooltip content="Select (V)" placement="right" hoist>
            <button class="tool-btn active" data-tool="select">
                <svg viewBox="0 0 24 24"><path d="M4 4l7 19 2.5-7.5L21 13z"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Pan (H)" placement="right" hoist>
            <button class="tool-btn" data-tool="pan">
                <svg viewBox="0 0 24 24"><path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
            </button>
        </wa-tooltip>

        <div class="tool-separator"></div>

        <!-- Post-it / Sticky Note -->
        <wa-tooltip content="Sticky Note (S)" placement="right" hoist>
            <button class="tool-btn" data-tool="sticky">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" fill="#FFF176" stroke="#E6D96A" stroke-width="1.5"/><path d="M15 3v6h6" fill="#E6D96A" stroke="none"/><line x1="7" y1="10" x2="17" y2="10" stroke="#999" stroke-width="1"/><line x1="7" y1="14" x2="14" y2="14" stroke="#999" stroke-width="1"/></svg>
            </button>
        </wa-tooltip>
        <!-- Text Box -->
        <wa-tooltip content="Text Box" placement="right" hoist>
            <button class="tool-btn" data-tool="textbox">
                <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="16" rx="2" fill="none"/><line x1="7" y1="9" x2="17" y2="9" stroke-width="1.5"/><line x1="7" y1="13" x2="15" y2="13" stroke-width="1.5"/><line x1="7" y1="17" x2="12" y2="17" stroke-width="1.5"/></svg>
            </button>
        </wa-tooltip>

        <div class="tool-separator"></div>

        <!-- Shapes -->
        <wa-tooltip content="Rectangle (R)" placement="right" hoist>
            <button class="tool-btn" data-tool="rect">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="1"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Circle (C)" placement="right" hoist>
            <button class="tool-btn" data-tool="circle">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Triangle" placement="right" hoist>
            <button class="tool-btn" data-tool="triangle">
                <svg viewBox="0 0 24 24"><polygon points="12,3 22,21 2,21" fill="none"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Diamond" placement="right" hoist>
            <button class="tool-btn" data-tool="diamond">
                <svg viewBox="0 0 24 24"><polygon points="12,2 22,12 12,22 2,12" fill="none"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Hexagon" placement="right" hoist>
            <button class="tool-btn" data-tool="hexagon">
                <svg viewBox="0 0 24 24"><polygon points="12,2 21,7 21,17 12,22 3,17 3,7" fill="none"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Star" placement="right" hoist>
            <button class="tool-btn" data-tool="star">
                <svg viewBox="0 0 24 24"><polygon points="12,2 15,9 22,9 16.5,14 18.5,21 12,17 5.5,21 7.5,14 2,9 9,9" fill="none"/></svg>
            </button>
        </wa-tooltip>

        <div class="tool-separator"></div>

        <!-- Lines -->
        <wa-tooltip content="Line (L)" placement="right" hoist>
            <button class="tool-btn" data-tool="line">
                <svg viewBox="0 0 24 24"><line x1="5" y1="19" x2="19" y2="5"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Arrow (A)" placement="right" hoist>
            <button class="tool-btn" data-tool="arrow">
                <svg viewBox="0 0 24 24"><line x1="5" y1="19" x2="19" y2="5"/><polyline points="10 5 19 5 19 14"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Connector (K)" placement="right" hoist>
            <button class="tool-btn" data-tool="connector">
                <svg viewBox="0 0 24 24">
                    <rect x="2" y="2" width="7" height="7" rx="1" fill="none"/>
                    <rect x="15" y="15" width="7" height="7" rx="1" fill="none"/>
                    <line x1="9" y1="5.5" x2="15" y2="18.5" stroke-dasharray="2 2"/>
                    <polygon points="15,18.5 12.5,14.5 17.5,14.5" fill="currentColor" stroke="none"/>
                </svg>
            </button>
        </wa-tooltip>

        <div class="tool-separator"></div>

        <!-- Drawing & Text -->
        <wa-tooltip content="Draw (D)" placement="right" hoist>
            <button class="tool-btn" data-tool="draw">
                <svg viewBox="0 0 24 24"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/></svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Text (T)" placement="right" hoist>
            <button class="tool-btn" data-tool="text">
                <svg viewBox="0 0 24 24"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg>
            </button>
        </wa-tooltip>

        <div class="tool-separator"></div>

        <!-- Style controls -->
        <wa-tooltip content="Stroke Color" placement="right" hoist>
            <button class="tool-btn" data-tool="color">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="9" fill="currentColor" stroke="currentColor"/>
                </svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Fill Color" placement="right" hoist>
            <button class="tool-btn" data-tool="fill-color">
                <svg viewBox="0 0 24 24">
                    <rect x="4" y="4" width="16" height="16" rx="2" fill="#eee" stroke="currentColor" stroke-width="2"/>
                    <path d="M4 14l8-8 8 8" fill="currentColor" opacity="0.3"/>
                </svg>
            </button>
        </wa-tooltip>
        <wa-tooltip content="Stroke Width" placement="right" hoist>
            <button class="tool-btn" data-tool="stroke-width">
                <svg viewBox="0 0 24 24"><line x1="4" y1="8" x2="20" y2="8" stroke-width="1"/><line x1="4" y1="14" x2="20" y2="14" stroke-width="3"/><line x1="4" y1="20" x2="20" y2="20" stroke-width="5"/></svg>
            </button>
        </wa-tooltip>
    </div>

    <!-- Stroke color picker - Web Awesome -->
    <div id="color-picker">
        <wa-color-picker id="stroke-color-wa" value="#333333" size="small" label="Stroke color"
            swatches="#333333; #F44336; #2196F3; #4CAF50; #FF9800; #9C27B0; #FFFFFF"
            hoist></wa-color-picker>
    </div>

    <!-- Fill color picker - Web Awesome -->
    <div id="fill-picker">
        <wa-color-picker id="fill-color-wa" value="" size="small" label="Fill color" opacity
            swatches="#FFF176; #F48FB1; #81D4FA; #A5D6A7; #CE93D8; #FFCC80; #FFFFFF; transparent"
            hoist></wa-color-picker>
    </div>

    <!-- Stroke width picker -->
    <div id="stroke-picker">
        <label>Stroke: <span id="stroke-value">2</span>px</label>
        <wa-range id="stroke-range" min="1" max="20" value="2" tooltip="none" style="width:120px"></wa-range>
    </div>

    <!-- Connector config panel -->
    <div id="connector-config">
        <div class="connector-section">
            <label>Start</label>
            <div class="marker-group">
                <button class="marker-btn active" data-end="source" data-marker="none" title="None">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="arrow" title="Arrow">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><polygon points="2,8 12,3 12,13" fill="currentColor"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="one" title="One">
                    <svg viewBox="0 0 32 16"><line x1="6" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="6" y1="2" x2="6" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="many" title="Many">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="one-many" title="One or Many">
                    <svg viewBox="0 0 32 16"><line x1="16" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="14" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="zero-many" title="Zero or Many">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="zero-one" title="Zero or One">
                    <svg viewBox="0 0 32 16"><line x1="6" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="14" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="6" y1="2" x2="6" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
            </div>
        </div>
        <div class="connector-section">
            <label>End</label>
            <div class="marker-group">
                <button class="marker-btn" data-end="target" data-marker="none" title="None">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn active" data-end="target" data-marker="arrow" title="Arrow">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><polygon points="30,8 20,3 20,13" fill="currentColor"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="one" title="One">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="26" y2="8" stroke="currentColor" stroke-width="2"/><line x1="26" y1="2" x2="26" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="many" title="Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="one-many" title="One or Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="16" y2="8" stroke="currentColor" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="14" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="zero-many" title="Zero or Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="14" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="zero-one" title="Zero or One">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="26" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="20" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="26" y1="2" x2="26" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
            </div>
        </div>
        <div class="connector-section">
            <label>Style</label>
            <div class="line-style-group">
                <button class="line-style-btn active" data-style="solid" title="Solid">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="line-style-btn" data-style="dashed" title="Dashed">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2" stroke-dasharray="4 3"/></svg>
                </button>
                <button class="line-style-btn" data-style="dotted" title="Dotted">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2" stroke-dasharray="1.5 3"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Text input overlay -->
    <div id="text-input-overlay">
        <textarea id="text-input" rows="1"></textarea>
    </div>

    <!-- Share dialog - Web Awesome -->
    <wa-dialog id="share-dialog" label="Share Board" style="--width: 500px">
        <div style="margin-bottom: 16px">
            <h3 style="font-size:14px; margin-bottom:8px">Add Collaborator</h3>
            <div style="display:flex; gap:8px; align-items:end">
                <wa-input id="share-username" placeholder="Username" size="small" style="flex:1"></wa-input>
                <wa-select id="share-role" value="editor" size="small" style="min-width:100px">
                    <wa-option value="editor">Editor</wa-option>
                    <wa-option value="viewer">Viewer</wa-option>
                </wa-select>
                <wa-button id="btn-add-collab" variant="brand" size="small">Add</wa-button>
            </div>
        </div>

        <div style="margin-bottom: 16px">
            <h3 style="font-size:14px; margin-bottom:8px">Share Links</h3>
            <div id="share-links-list" style="margin-bottom:8px; max-height: 150px; overflow-y: auto"></div>
            <div style="display:flex; gap:8px; align-items:end">
                <wa-select id="link-role" value="viewer" size="small" style="min-width:100px">
                    <wa-option value="viewer">Viewer</wa-option>
                    <wa-option value="editor">Editor</wa-option>
                </wa-select>
                <wa-button id="btn-create-link" variant="neutral" size="small" outline>Create Share Link</wa-button>
            </div>
        </div>

        <wa-button slot="footer" variant="neutral" id="btn-close-share">Close</wa-button>
    </wa-dialog>

    <!-- Context menu - Web Awesome -->
    <wa-dropdown id="context-menu" placement="bottom-start" hoist style="position:fixed; z-index:9999">
        <div slot="trigger" style="display:none"></div>
        <wa-menu id="context-menu-items">
            <!-- Items populated dynamically -->
        </wa-menu>
    </wa-dropdown>

    <!-- Plugin sidebar - Web Awesome Drawer -->
    <wa-drawer id="plugin-sidebar" placement="end" no-header style="--size: 320px;">
        <div id="plugin-sidebar-header" style="display:flex; align-items:center; justify-content:space-between; padding:8px 12px; border-bottom:1px solid var(--wa-color-neutral-200);">
            <wa-tab-group id="plugin-sidebar-tabs" style="flex:1">
            </wa-tab-group>
            <wa-icon-button id="plugin-sidebar-close" name="xmark" label="Close sidebar"></wa-icon-button>
        </div>
        <div id="plugin-sidebar-content" style="padding:16px; overflow-y:auto; flex:1;"></div>
    </wa-drawer>

    <!-- Toast container for wa-alert based notifications -->
    <div id="wa-toast-stack" style="position:fixed; bottom:20px; right:20px; z-index:2000; display:flex; flex-direction:column-reverse; gap:8px; pointer-events:none;"></div>

    <!-- Canvas -->
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>

    <script type="module">
        import { WhiteboardApp } from '/js/canvas.js?v=3';

        const params = new URLSearchParams(window.location.search);
        const boardId = params.get('id');
        const shareToken = params.get('share');

        if (!boardId && !shareToken) {
            window.location.href = '/';
        }

        const app = new WhiteboardApp('canvas', {
            boardId,
            shareToken,
        });
        window.__whiteboardApp = app;
    </script>
</body>
</html>
