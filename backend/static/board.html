<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiteboard</title>
    <link rel="stylesheet" href="/vendor/webawesome/styles/webawesome.css?v=3">
    <link rel="stylesheet" href="/css/style.css?v=3">
    <script type="importmap">
    {
        "imports": {
            "yjs": "/js/vendor/yjs.mjs"
        }
    }
    </script>
    <script type="module" src="/vendor/webawesome/webawesome.bundle.js?v=3" data-webawesome="/vendor/webawesome" data-fa-kit-code="6c95c86d90"></script>
</head>
<body>
    <!-- Top bar -->
    <div id="top-bar">
        <button class="top-btn" id="btn-back">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <wa-tooltip for="btn-back" placement="bottom">Back to dashboard</wa-tooltip>
        <span id="board-name">Untitled Board</span>
        <span id="zoom-level">100%</span>
        <button class="top-btn" id="btn-undo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 10h10a5 5 0 0 1 0 10H9"/>
                <path d="M3 10l4-4M3 10l4 4"/>
            </svg>
        </button>
        <wa-tooltip for="btn-undo" placement="bottom">Undo (Ctrl+Z)</wa-tooltip>
        <button class="top-btn" id="btn-redo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10H11a5 5 0 0 0 0 10h4"/>
                <path d="M21 10l-4-4M21 10l-4 4"/>
            </svg>
        </button>
        <wa-tooltip for="btn-redo" placement="bottom">Redo (Ctrl+Shift+Z)</wa-tooltip>
        <button class="top-btn" id="btn-share">Share</button>
        <wa-tooltip for="btn-share" placement="bottom">Share board</wa-tooltip>
    </div>

    <!-- Presence bar -->
    <div id="presence-bar"></div>

    <!-- Toolbar -->
    <div id="toolbar">
        <!-- Selection & Navigation -->
        <button class="tool-btn active" data-tool="select" id="tool-select">
            <wa-icon name="arrow-pointer" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="pan" id="tool-pan">
            <wa-icon name="hand" family="sharp" variant="thin"></wa-icon>
        </button>

        <div class="tool-separator"></div>

        <!-- Post-it / Sticky Note -->
        <button class="tool-btn" data-tool="sticky" id="tool-sticky">
            <wa-icon name="note-sticky" family="sharp" variant="thin"></wa-icon>
        </button>
        <!-- Text Box -->
        <button class="tool-btn" data-tool="textbox" id="tool-textbox">
            <wa-icon name="rectangle-list" family="sharp" variant="thin"></wa-icon>
        </button>

        <div class="tool-separator"></div>

        <!-- Shapes -->
        <button class="tool-btn" data-tool="rect" id="tool-rect">
            <wa-icon name="square" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="circle" id="tool-circle">
            <wa-icon name="circle" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="triangle" id="tool-triangle">
            <wa-icon name="triangle" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="diamond" id="tool-diamond">
            <wa-icon name="diamond" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="hexagon" id="tool-hexagon">
            <wa-icon name="hexagon" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="star" id="tool-star">
            <wa-icon name="star" family="sharp" variant="thin"></wa-icon>
        </button>

        <div class="tool-separator"></div>

        <!-- Lines -->
        <button class="tool-btn" data-tool="line" id="tool-line">
            <wa-icon name="slash-forward" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="arrow" id="tool-arrow">
            <wa-icon name="arrow-right-long" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="connector" id="tool-connector">
            <wa-icon name="diagram-project" family="sharp" variant="thin"></wa-icon>
        </button>

        <div class="tool-separator"></div>

        <!-- Drawing & Text -->
        <button class="tool-btn" data-tool="draw" id="tool-draw">
            <wa-icon name="pen" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="text" id="tool-text">
            <wa-icon name="font" family="sharp" variant="thin"></wa-icon>
        </button>

        <div class="tool-separator"></div>

        <!-- Style controls -->
        <button class="tool-btn" data-tool="color" id="tool-color">
            <wa-icon name="palette" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="fill-color" id="tool-fill-color">
            <wa-icon name="fill-drip" family="sharp" variant="thin"></wa-icon>
        </button>
        <button class="tool-btn" data-tool="stroke-width" id="tool-stroke-width">
            <wa-icon name="grip-lines" family="sharp" variant="thin"></wa-icon>
        </button>
    </div>

    <!-- Toolbar tooltips (WA Pro 3: separate elements with for= attribute) -->
    <wa-tooltip for="tool-select" placement="right">Select (V)</wa-tooltip>
    <wa-tooltip for="tool-pan" placement="right">Pan (H)</wa-tooltip>
    <wa-tooltip for="tool-sticky" placement="right">Sticky Note (S)</wa-tooltip>
    <wa-tooltip for="tool-textbox" placement="right">Text Box</wa-tooltip>
    <wa-tooltip for="tool-rect" placement="right">Rectangle (R)</wa-tooltip>
    <wa-tooltip for="tool-circle" placement="right">Circle (C)</wa-tooltip>
    <wa-tooltip for="tool-triangle" placement="right">Triangle</wa-tooltip>
    <wa-tooltip for="tool-diamond" placement="right">Diamond</wa-tooltip>
    <wa-tooltip for="tool-hexagon" placement="right">Hexagon</wa-tooltip>
    <wa-tooltip for="tool-star" placement="right">Star</wa-tooltip>
    <wa-tooltip for="tool-line" placement="right">Line (L)</wa-tooltip>
    <wa-tooltip for="tool-arrow" placement="right">Arrow (A)</wa-tooltip>
    <wa-tooltip for="tool-connector" placement="right">Connector (K)</wa-tooltip>
    <wa-tooltip for="tool-draw" placement="right">Draw (D)</wa-tooltip>
    <wa-tooltip for="tool-text" placement="right">Text (T)</wa-tooltip>
    <wa-tooltip for="tool-color" placement="right">Stroke Color</wa-tooltip>
    <wa-tooltip for="tool-fill-color" placement="right">Fill Color</wa-tooltip>
    <wa-tooltip for="tool-stroke-width" placement="right">Stroke Width</wa-tooltip>

    <!-- Stroke color picker - Web Awesome -->
    <div id="color-picker">
        <wa-color-picker id="stroke-color-wa" value="#333333" size="small" label="Stroke color"
            swatches="#333333; #F44336; #2196F3; #4CAF50; #FF9800; #9C27B0; #FFFFFF"
            hoist></wa-color-picker>
    </div>

    <!-- Fill color picker - Web Awesome -->
    <div id="fill-picker">
        <wa-color-picker id="fill-color-wa" value="" size="small" label="Fill color" opacity
            swatches="#FFF176; #F48FB1; #81D4FA; #A5D6A7; #CE93D8; #FFCC80; #FFFFFF; transparent"
            hoist></wa-color-picker>
    </div>

    <!-- Stroke width picker -->
    <div id="stroke-picker">
        <label>Stroke: <span id="stroke-value">2</span>px</label>
        <wa-slider id="stroke-range" min="1" max="20" value="2" tooltip="none" style="width:120px"></wa-slider>
    </div>

    <!-- Connector config panel -->
    <div id="connector-config">
        <div class="connector-section">
            <label>Start</label>
            <div class="marker-group">
                <button class="marker-btn active" data-end="source" data-marker="none" title="None">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="arrow" title="Arrow">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><polygon points="2,8 12,3 12,13" fill="currentColor"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="one" title="One">
                    <svg viewBox="0 0 32 16"><line x1="6" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="6" y1="2" x2="6" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="many" title="Many">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="one-many" title="One or Many">
                    <svg viewBox="0 0 32 16"><line x1="16" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="14" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="zero-many" title="Zero or Many">
                    <svg viewBox="0 0 32 16"><line x1="12" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="12" y1="8" x2="2" y2="2" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="8" stroke="currentColor" stroke-width="2"/><line x1="12" y1="8" x2="2" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="source" data-marker="zero-one" title="Zero or One">
                    <svg viewBox="0 0 32 16"><line x1="6" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="14" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="6" y1="2" x2="6" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
            </div>
        </div>
        <div class="connector-section">
            <label>End</label>
            <div class="marker-group">
                <button class="marker-btn" data-end="target" data-marker="none" title="None">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn active" data-end="target" data-marker="arrow" title="Arrow">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><polygon points="30,8 20,3 20,13" fill="currentColor"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="one" title="One">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="26" y2="8" stroke="currentColor" stroke-width="2"/><line x1="26" y1="2" x2="26" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="many" title="Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="one-many" title="One or Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="16" y2="8" stroke="currentColor" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="14" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="zero-many" title="Zero or Many">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="14" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="20" y1="8" x2="30" y2="2" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="8" stroke="currentColor" stroke-width="2"/><line x1="20" y1="8" x2="30" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="marker-btn" data-end="target" data-marker="zero-one" title="Zero or One">
                    <svg viewBox="0 0 32 16"><line x1="2" y1="8" x2="26" y2="8" stroke="currentColor" stroke-width="2"/><circle cx="20" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="26" y1="2" x2="26" y2="14" stroke="currentColor" stroke-width="2"/></svg>
                </button>
            </div>
        </div>
        <div class="connector-section">
            <label>Style</label>
            <div class="line-style-group">
                <button class="line-style-btn active" data-style="solid" title="Solid">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2"/></svg>
                </button>
                <button class="line-style-btn" data-style="dashed" title="Dashed">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2" stroke-dasharray="4 3"/></svg>
                </button>
                <button class="line-style-btn" data-style="dotted" title="Dotted">
                    <svg viewBox="0 0 32 8"><line x1="2" y1="4" x2="30" y2="4" stroke="currentColor" stroke-width="2" stroke-dasharray="1.5 3"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Text input overlay -->
    <div id="text-input-overlay">
        <textarea id="text-input" rows="1"></textarea>
    </div>

    <!-- Share dialog - Web Awesome -->
    <wa-dialog id="share-dialog" label="Share Board" style="--width: 500px">
        <div style="margin-bottom: 16px">
            <h3 style="font-size:14px; margin-bottom:8px">Add Collaborator</h3>
            <div style="display:flex; gap:8px; align-items:end">
                <wa-input id="share-username" placeholder="Username" size="small" style="flex:1"></wa-input>
                <wa-select id="share-role" value="editor" size="small" style="min-width:100px">
                    <wa-option value="editor">Editor</wa-option>
                    <wa-option value="viewer">Viewer</wa-option>
                </wa-select>
                <wa-button id="btn-add-collab" variant="brand" size="small">Add</wa-button>
            </div>
        </div>

        <div style="margin-bottom: 16px">
            <h3 style="font-size:14px; margin-bottom:8px">Share Links</h3>
            <div id="share-links-list" style="margin-bottom:8px; max-height: 150px; overflow-y: auto"></div>
            <div style="display:flex; gap:8px; align-items:end">
                <wa-select id="link-role" value="viewer" size="small" style="min-width:100px">
                    <wa-option value="viewer">Viewer</wa-option>
                    <wa-option value="editor">Editor</wa-option>
                </wa-select>
                <wa-button id="btn-create-link" variant="neutral" size="small" outline>Create Share Link</wa-button>
            </div>
        </div>

        <wa-button slot="footer" variant="neutral" id="btn-close-share">Close</wa-button>
    </wa-dialog>

    <!-- Context menu -->
    <div id="context-menu" style="display:none; position:fixed; z-index:9999;">
        <div id="context-menu-items" role="menu">
            <!-- Items populated dynamically -->
        </div>
    </div>

    <!-- Plugin sidebar - Web Awesome Drawer -->
    <wa-drawer id="plugin-sidebar" placement="end" no-header style="--size: 320px;">
        <div id="plugin-sidebar-header" style="display:flex; align-items:center; justify-content:space-between; padding:8px 12px; border-bottom:1px solid var(--wa-color-neutral-200);">
            <wa-tab-group id="plugin-sidebar-tabs" style="flex:1">
            </wa-tab-group>
            <wa-button id="plugin-sidebar-close" variant="text" size="small" label="Close sidebar">
                <wa-icon name="xmark"></wa-icon>
            </wa-button>
        </div>
        <div id="plugin-sidebar-content" style="padding:16px; overflow-y:auto; flex:1;"></div>
    </wa-drawer>

    <!-- Toast container for wa-callout based notifications -->
    <div id="wa-toast-stack" style="position:fixed; bottom:20px; right:20px; z-index:2000; display:flex; flex-direction:column-reverse; gap:8px; pointer-events:none;"></div>

    <!-- Canvas -->
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>

    <script type="module">
        import { WhiteboardApp } from '/js/canvas.js?v=3';

        const params = new URLSearchParams(window.location.search);
        const boardId = params.get('id');
        const shareToken = params.get('share');

        if (!boardId && !shareToken) {
            window.location.href = '/';
        }

        const app = new WhiteboardApp('canvas', {
            boardId,
            shareToken,
        });
        window.__whiteboardApp = app;
    </script>
</body>
</html>
